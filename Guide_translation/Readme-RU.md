# Добро пожаловать в руководство по созданию пользовательского часового интерфейса для версии Артема xdrip для GRT 2e!

Данное руководство автоматически переведено на:
- Китайский (CHN) 
- немецкий (DE)
- испанский (ES)
- французский (FR)
- итальянский (IT)
- русский (RU)
Я говорю только на DE и EN, поэтому, пожалуйста, если вы вступаете в контакт, делайте это на английском!

Это руководство проведет вас через все шаги, необходимые для адаптации часового интерфейса под xdrip. Я не являюсь носителем языка, поэтому не стесняйтесь предлагать изменения.
Это руководство посвящено адаптации существующего интерфейса часов под наши нужды. Если вы достаточно креативны и умелы, чтобы создать свой собственный часовой интерфейс, это руководство поможет вам с технической адаптацией для использования его в xdrip.

Пожалуйста, помните, что это руководство предназначено только для **GTR 2e**! Многие вещи схожи для разных часов, особенно для GTR 2 и GTS 2(e). Если вы используете это руководство для создания часовых интерфейсов для разных часов, пожалуйста, присылайте текстовые фрагменты через issue, чтобы помочь этому руководству подходить и для других часов. 

Основная заслуга принадлежит **Артему Коваленко**, который сделал Amazfit GTR2, GTR2e, GTS2, GTS2e, GTR42, Bip, BIP S и GTR 47 возможными! Кроме того, он очень помог мне создать мой первый собственный часовой интерфейс.
#### Пожалуйста, поддержите его здесь: https://www.patreon.com/xdrip_miband
Вы можете прочитать больше о его проектах, связанных с xdrip здесь: https://bigdigital.home.blog/.

Кроме того, спасибо:

 - [**SashaCX75**](https://amazfitwatchfaces.com/forum/memberlist.php?mode=viewprofile&u=113690) помог создать watchfaceditor 
 - всем создателям watchface


> 

### Пример Watchface


В папке [01-WF-MD225-Version3-xdrip-ready](https://github.com/twinko/GTR-2-WF-Xdrip-EN/tree/main/01-WF-MD225-Version3-xdrip-ready
"01-WF-MD225-Version3-xdrip-ready") вы найдете конечный продукт пользовательского watchface. Позже я дам ссылку на другой репозиторий с разными часовыми интерфейсами, которые я создал. 

**Если вы создали свой собственный watchface, пожалуйста, поделитесь им с другими. Мы могли бы собрать их в одном репозитории, не стесняйтесь связаться со мной через issue.**.


## Вещи, которые вам понадобятся

Я буду использовать следующие инструменты. Вам понадобятся все из них. Все инструменты ниже бесплатны для личного использования.

1. ОС Windows
2. **WFE**: [AmazFit WatchFace editor 2 for Windows](https://amazfitwatchfaces.com/forum/viewtopic.php?p=8392#p8392)
3. **PS**: Photoshop (версия CS2 доступна бесплатно) https://archive.fo/255q5#selection-1663.0-1663.29.
5. **WF**: Часовой интерфейс. (следующая глава)
6. Скачайте весь репозиторий, позже нам понадобятся некоторые файлы из папки "Guide". Вы можете загрузить этот репозиторий, нажав на зеленую кнопку "code" в верхней части этой страницы и выбрав "Download ZIP".

## Найдите часовой интерфейс, который вы хотели бы использовать.

Если вы не создаете свой собственный часовой интерфейс, вы можете поискать часовые интерфейсы здесь: https://amazfitwatchfaces.com/gtr/top?compatible=GTR_2.
Загрузите нужный файл. Пожалуйста, обратите внимание на часы, для которых был создан часовой интерфейс.

**Очень важно:**. 

 - Чем меньше часовой интерфейс, тем лучше. Мы поговорим об этом позже, но все картинки, включая json-файл, не должны быть больше 50 кб. 
 - Размер часового интерфейса 50 кб (необработанные изображения и json) приведет к времени загрузки около 10 секунд, а вы не хотите, чтобы это заняло больше времени, из-за времени работы батареи и вы не хотите ждать до завтра.
 - Это означает меньше иконок, меньше меняющихся вещей (за исключением цифр, и да, только цифр). 
 - Избегайте часовых интерфейсов с градиентами (когда один цвет переходит в другой). 
 - Помните, что мы хотим иметь возможность легко считывать уровень глюкозы в крови (BG), поэтому нам нужно где-то освободить место. Я бы выделил не менее 1/3 поверхности часов под всю информацию, связанную с xdrip.

# 1. Руководство / учебник

1. Скачайте всю папку с последней версией WFE (редактор часового интерфейса), ссылка на которую приведена выше. 
2. Вы можете найти кнопку "скачать" в правом верхнем углу, нам нужна вся папка! 
3. После нажатия кнопки "скачать" выберите "прямая загрузка". Будет загружен файл вида "AmazFit_Watchface_Editor_2_v5.1.zip".
4. Распакуйте файл
5. Откройте (в моем случае) "AmazFit_Watchface_Editor_2".
6. запустить "AmazFit_Watchface_Editor_2.exe"
7. Кнопкой вправо выберите "Распаковать сжатую корзину".
8. Выберите часовой интерфейс, который вы скачали ранее
9. Распакованный интерфейс часов можно найти здесь: ...\AmazFit_Watchface_Editor_2\Watch_face
10. Теперь вам нужно ознакомиться с WFE.
11. Я объясню только абсолютные основы. Чтобы узнать больше о редакторе часового интерфейса и его возможностях, загляните сюда: https://amazfitwatchfaces.com/forum/viewtopic.php?f=14&t=1571.
Прямая ссылка на английский перевод: https://translate.google.com/translate?hl=ru&sl=ru&tl=en&u=https%3A%2F%2Fowagner.ru%2Famazfitgtr%2Fwfcreator%2Fwatchfaces_creator_lesson%2F
12. Перейдите на вкладку "Редактировать" и щелкните по различным опциям с правой стороны. 
13. Выберите "Layer order", чтобы определить такие вещи, как порядок дат (dd-mm-yy или mm-dd-yy).

> **Важная подсказка:**. 
> Наша самая важная цель - уменьшить размер. Как написано
> выше, мы хотим получить необработанные файлы png размером менее 50 кб (включая .json).
> 
> Лучший способ уменьшить размер:
> - меньше картинок
> - меньше цветов (уменьшает размер файлов картинок)
> - использовать системный шрифт (настройка во вкладке редактирования WFE, где он показывает цифры).

14. Когда вы закончите изменения, сохраните часовой интерфейс (вкладка "Edit", внизу в середине "save Json").

> **То, что мне очень помогло:**.
> - картинка 0001.png всегда является фоном. Обычно необходимо адаптировать фон под график глюкозы и все необходимые данные. Используйте для этого Photoshop или другую программу
> - посмотрите на распакованные картинки, удалите все ненужные.
> - Вам нужно переименовать файлы от 0001- xxxx У вас будут проблемы позже, если файлы не будут расположены в ряд. Невозможно, чтобы один
> номер между ними отсутствует. Это должно выглядеть как: 0001, 0002, ......
> 0015.) Вы можете использовать https://www.bulkrenameutility.co.uk/Download.php для массового переименования файлов.

15. Перейдите в папку с json и всеми необходимыми файлами на вашем компьютере.
16. Сделайте резервную копию всех существующих файлов и json.

## 1.1 Редактирование фона часового интерфейса
Если ваш циферблат имеет обычный цвет, отредактируйте его в WFE. Но вам нужно будет создать картинку, на которой будет размещена вся дата xdrip, поэтому создайте подходящее по цвету изображение в PS и пропустите следующую часть, где я описываю, как вырезать картинку.

17. Откройте 0001.png (ваше фоновое изображение) в PS.
18. Перейдите в меню Изображение->Режим и измените его на RGB.
19. Выберите инструмент Rightangle-Tool, нажав "M", и выберите часть, где вы хотите, чтобы отображались данные xdrip.
![##**PS_cut_xdrip_part_01.PNG**](https://raw.githubusercontent.com/twinko/GTR-2-WF-Xdrip-EN/main/Guide/PS_cut_xdrip_part_01.PNG)

20. Щелкните правой кнопкой мыши внутри и выберите "Слой путем вырезания".
21. Сохраните этот файл как PS-файл (.psd).
22. Скройте остальную часть изображения, нажав на значок глаза справа (Слои) на Слое 1
![## **PS_cut_xdrip_part_02.PNG**](https://raw.githubusercontent.com/twinko/GTR-2-WF-Xdrip-EN/main/Guide/PS_cut_xdrip_part_02.PNG)
23. Нажмите "c", чтобы использовать инструмент вырезания
24. Обрежьте картинку до размера визуальной части циферблата часов.
25. Нажмите "enter" для подтверждения или галочку вверху.
26. Теперь сохраните это как **my_image.png**.
27. Откройте сохраненный psd-файл и проделайте то же самое с остальными часами, чтобы у нас было фоновое изображение, разделенное на 2 файла.


### 1.1.1 Уменьшение размера изображения
28. Откройте каждый файл, один за другим, в PS.
29. Кликните на Data -> Save for Web
30. В новом окне справа вы должны выбрать следующее:
	- png-8
	- Вы можете немного повозиться и удалить определенные цвета, что еще больше уменьшит размер изображения. Вы можете увидеть новый размер файла в правом нижнем углу.
	- Файлы должны быть в формате png! 
	- Если вы столкнулись со странной рамкой вокруг ваших изображений:
		- перейдите в меню "Изображение", "Режим" и измените его на "индексированные цвета" перед сохранением для веб.
31. Сохраните файл путем перезаписи (вы сделали резервную копию ранее). Я не нашел способа сделать это для всех файлов сразу, дайте мне знать, если вы знаете, как это сделать.

### 1.1.2 Поместите my_image.png в нужное место в WF
32. Теперь откройте WFE снова, вы должны заметить, что у нас есть вырез в середине циферблата часов. (если нет, сохраните вырезанное изображение в качестве фонового рисунка)
33. Перейдите в меню Правка --> Действия --> Жиросжигание --> Иконка
34. Скопируйте расположенную ниже картинку: ## GTR-2-WF-Xdrip-EN/[Guide](https://github.com/twinko/GTR-2-WF-Xdrip-EN/tree/main/Guide)/**0099.png** она имеет размер всего 1 пиксель. Позже мы заменим его на my_image.png с помощью кода. Но это значительно сэкономит нам размер часового интерфейса.
35. Теперь нужно поместить его в левый верхний угол нашего выреза. Чтобы найти правильные координаты, прочитайте следующую тему ниже (Как найти правильные координаты в PS)

## 1.2 Подготовка окончательного вида часов
То, что у вас должно быть на данный момент в 1 папке:
- json, который вы создали с помощью WFE
- все необходимые файлы WF, максимально уменьшенные в размере
- my_image.png, максимально уменьшенный в размере
--> мы приближаемся к вашему финальному WF :)

36. Перейдите на ....\AmazFit_Watchface_Editor_2\Tools
37. удерживайте shift+прямая кнопка мыши в этой папке
38. Выберите "Открыть окно Powershell здесь".
39. Чтобы упаковать json, достаточно перейти в папку tools и выполнить команду следующим образом  
`main.exe --gtr2 47 --file config-file.json`, где config-file.json - это местоположение вашего json.
	- У меня были некоторые проблемы с этим, и мне нужно было добавить весь путь перед main.exe, так что это было что-то вроде этого:
		- `C:`\Users\twinko\Desktop\AmazFit_Watchface_Editor_2\AmazFit_Watchface_Editor_2\Tools\main. exe --gtr2 47 --file C:\Users\TwinkosTower\Desktop\AmazFit_Watchface_Editor_2\AmazFit_Watchface_Editor_2\Watch_face\gtr2-g7en-colormix03-346659-994092c337\Small\WF_2_V01.json`
40. В результате вы должны получить распакованный bin-файл. Этот файл вам нужно будет использовать в xdrip. Xdrip внедрит в этот файл необходимые ресурсы, сожмет его и отправит на часы.
41. Переименуйте bin в: my_watchface.bin
42. Создайте новую папку, поместив в нее следующие файлы:
- my_watchface.bin, который мы создали
- my_image.png


## 1.3 Редактирование config.json

В config.json определяется, где на my_image.png какие данные xdrip будут показаны и как. Он отличается от json, созданного WFE, не путайте их!

Оригинальный config.json, созданный Артемом, находится здесь:
https://github.com/twinko/GTR-2-WF-Xdrip-EN/blob/main/Guide/config.json
Если вы скачали репозиторий ранее, возьмите файл из папки Guide!



> **Общие сведения:**
> - этот config.json относится только к файлу my_image.png
> - поэтому если мы говорим о координатах (x и y), то они основаны на my_image.png и его общем размере, а не на всем watchface.
> - прочитайте пост Артема о выравнивании здесь: https://github.com/bigdigital/xDrip-miband/issues/5#issuecomment-878008056
> - text_align: "right" 
> - вам нужно считать пиксели, начиная с правой стороны.
> - так что если написано: x: 100 и text align - right, то отсчитывая 100 пикселей от правой стороны картинки, можно определить, где находится элемент.

### 1.3.1 Как найти правильные координаты в PS
43. Откройте файл my_image.png в PS
44. нажмите F8, появится небольшое информационное окно.
45. Если вы наведете курсор мыши на картинку, вы увидите, что числа X и Y перемещаются. 

### 1.3.2 config.json объяснение
46. откройте config.json с помощью блокнота
47. Вы увидите небольшой кластер, который вполне самообъясним.
48. Нам нужно только отредактировать resource_to_replace, X, Y font_size, возможно bg_color графика

#### 1.3.2.1 resource_to_replace
49. вставьте номер изображения, которое мы выбрали для Fat-burning-->Icon (если ваше fiurst изображение называется 0001.png) уменьшите номер на единицу. Алгоритм начинает считать с 0)

#### 1.3.2.2 "x" , "y" и "text_align": "right",
50. как описано в "Как найти правильные координаты в PS", вы можете найти правильную позицию для размещения данных xdrip. 

> **Подсказка**: Системным шрифтом является "Segoe UI", поэтому нажмите t в PS для написания текста и
> поместите определенный текст в файл my_image.png и найдите нужные
> координаты. Помните *x и y - это левая нижняя часть первой > буквы/числа*.
> буквы/числа*. Не сохраняйте my_image.png с номерами, которые вы >
> записали, это будет сделано позже с помощью магии Artems, мы делаем это в PS
> чтобы узнать правильные координаты, не более.

51. Теперь измените все координаты в соответствии с вашими потребностями.
52. Внимание: есть некоторые значения, которые имеют следующую строку: `"text_align": "right",` для них у нас есть другое правило для координат. *Поместите в Buttom правую координату последней буквы/числа.*.

#### 1.3.2.3 "font_size".
53. вставьте тот же размер шрифта, который вы выбрали в PS.

### 1.3.3 Сохранить config.json
54. Сохраните config.json в папку, включающую my_image.png и my_watchface.bin (config.json, а не my_config.json!).


## 1.4 Загрузка и тестирование

55. Теперь у нас должна быть папка со следующими файлами:
- config.json 
- my_image.png 
- my_watchface.bin  
56. вставьте эти 3 файла в папку xdrip на вашем смартфоне. 
- Нужная папка xdrip находится здесь:
	- internat storage/xdrip или
	- root/storage/emulated/0/xdrip
57. Включите пользовательский часовой интерфейс в настройках xdrip.
58. Готово!

# 2. Сноска

Если у вас возникнут проблемы, пожалуйста, откройте здесь вопрос. Пожалуйста, проведите собственное исследование заранее, я также обычный парень, который делает это в свободное время. 
https://github.com/twinko/GTR-2-WF-Xdrip-EN/issues

Если у вас есть предложения, как улучшить руководство или сделать его пригодным и для других watchfaces, напишите об этом также :)

Надеюсь, это руководство было полезным :)
